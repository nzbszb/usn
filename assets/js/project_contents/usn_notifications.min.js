$(document).ready(function() {

    setInterval(function ajaxNtf() {
        $('.toolbar_ntf').each(function () {
            var username = $(this).attr('data-username');

            $.ajax({
                type: 'post',
                url: '../../../views/user/contents/toolbar_notification/notifications.php', //Here you will fetch records
                data: {'username': username, 'ntf_type': 'ntf_seek'}, //Pass $id
                dataType: 'json',
                cache: false,
                context: this,
                success: function (data) {
                    // console.log(data);
                    len = data['ntf'].length;
                    if(len!=0) {
                        $('.toolbar_ntf').empty();
                        $('.ntf_count').empty();
                        $('.ntf_count').append(data['count']);
                        for(i=0;i<len;i++) {
                            // console.log(data[i]['notification_url']);

                            local = data['ntf'][i]['notification_utc_time'];
                            var localDate = new Date(local);
                            var today = new Date();
                            var old_date = localDate.getDate();
                            var new_date = today.getDate();
                            var old_month = localDate.getMonth();
                            var new_month = today.getMonth();
                            var old_year = localDate.getYear();
                            var new_year = today.getYear();
                            var days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
                            var day = days[localDate.getDay()];
                            if ((new_date - old_date) == 0) {
                                day = 'Today';

                                var localDateString = localDate.toLocaleDateString(undefined, {
                                    month: 'short',
                                    day: 'numeric'
                                });

                                var localTimeString = localDate.toLocaleTimeString(undefined, {
                                    hour: '2-digit',
                                    minute: '2-digit'
                                });
                                var ntf_time = day + ' at ' + localTimeString;
                            }
                            if ((new_date - old_date) == 1) {
                                day = 'Yesterday';

                                var localDateString = localDate.toLocaleDateString(undefined, {
                                    month: 'short',
                                    day: 'numeric'
                                });

                                var localTimeString = localDate.toLocaleTimeString(undefined, {
                                    hour: '2-digit',
                                    minute: '2-digit'
                                });
                                var ntf_time = day + ' at ' + localTimeString;
                            }
                            if (((new_date - old_date) > 1) || ((new_date - old_date) < 0)) {


                                var localDateString = localDate.toLocaleDateString(undefined, {
                                    month: 'short',
                                    day: 'numeric'
                                });


                                var localTimeString = localDate.toLocaleTimeString(undefined, {
                                    hour: '2-digit',
                                    minute: '2-digit'
                                });

                                var ntf_time = localDateString + ' at ' + localTimeString;
                            }

                            if (data['ntf'][i]['notification_type'] == 'seen') {

                                var data_show = "<li class=" + 'media' + "><div class=" + 'media-left' + "><a href=" + data['ntf'][i]['notification_url'] + " class="+'btn_ntf_seen'+" data-ntf="+data['ntf'][i]['notification_url']+"><i class="+'icon-eye4'+"></i></a></div><div class="+'media-body'+"><a href=" + data['ntf'][i]['notification_url'] + " class="+'ntf-id-read'+" data-ntf="+data['ntf'][i]['notification_url']+">"+data['ntf'][i]['notification_details']+"</a><div class="+'media-annotation'+">"+ntf_time+"</div></div></li>";
                                $(this).append(data_show);
                                $('.btn_ntf_seen').addClass('btn').addClass('border-primary').addClass('text-primary').addClass('btn-flat').addClass('btn-rounded').addClass('btn-icon').addClass('btn-sm').addClass('ntf-id-read');
                            }
                            if ((data['ntf'][i]['notification_type'] == 'comment') && (data['ntf'][i]['to_username'] == username)) {

                                var data_show = "<li class=" + 'media' + "><div class=" + 'media-left' + "><a href=" + data['ntf'][i]['notification_url'] + " class="+'btn_ntf_comment'+" data-ntf="+data['ntf'][i]['notification_url']+"><i class="+'icon-bubble-lines4'+"></i></a></div><div class="+'media-body'+"><a href=" + data['ntf'][i]['notification_url'] + " class="+'ntf-id-read'+" data-ntf="+data['ntf'][i]['notification_url']+">"+data['ntf'][i]['notification_details']+' your post'+"</a><div class="+'media-annotation'+">"+ntf_time+"</div></div></li>";
                                $(this).append(data_show);
                                $('.btn_ntf_comment').addClass('btn').addClass('border-warning').addClass('text-warning').addClass('btn-flat').addClass('btn-rounded').addClass('btn-icon').addClass('btn-sm').addClass('ntf-id-read');
                            }
                            if ((data['ntf'][i]['notification_type'] == 'connection') && (data['ntf'][i]['to_username'] == username)) {

                                var data_show = "<li class=" + 'media' + "><div class=" + 'media-left' + "><a href=" + data['ntf'][i]['notification_url'] + " class="+'btn_ntf_connection'+" data-ntf="+data['ntf'][i]['notification_url']+"><i class="+'icon-user-check'+"></i></a></div><div class="+'media-body'+"><a href=" + data['ntf'][i]['notification_url'] + " class="+'ntf-id-read'+" data-ntf="+data['ntf'][i]['notification_url']+">"+data['ntf'][i]['notification_details']+"</a><div class="+'media-annotation'+">"+ntf_time+"</div></div></li>";
                                $(this).append(data_show);
                                $('.btn_ntf_connection').addClass('btn').addClass('border-success').addClass('text-success').addClass('btn-flat').addClass('btn-rounded').addClass('btn-icon').addClass('btn-sm').addClass('ntf-id-read');
                            }
                        }
                    }else{
                        $('.toolbar_ntf').empty();
                        $('.ntf_count').empty();
                        $('.ntf_count').append(0);
                        $(this).empty();
                        $(this).append("<li class=" + 'media' + "><center>" + 'No Notifications' + "</center></li>");
                    }

                },
                complete: function (data) {
                    $('.ntf-id-read').click(function (r) {
                        var ntf_url = $(this).attr('data-ntf');
                        $.ajax({
                            type: 'post',
                            url: '../../../views/user/contents/toolbar_notification/notifications.php', //Here you will fetch records
                            data: {'ntf_url': ntf_url, 'ntf_type': 'ntf_read'}, //Pass $id
                            dataType: 'json',
                            cache: false,
                            context: this,
                            success: function (data) {
                                console.log(data);
                            },
                            complete: function (data) {

                            },
                            error: function (e) {
                                // Error
                            }
                        });

                    });
                },
                error: function (e) {
                    // Error
                }

            });
        });
        },10000);


$('.reload_ntf').click(function () {
        // ajaxTlbrNtf();
});
$('#ntf_stat').click(function () {
    var username = $(this).attr('data-username');
    $.ajax({
        type: 'post',
        url: '../../../views/user/contents/toolbar_notification/notifications.php', //Here you will fetch records
        data: {'username': username, 'ntf_type': 'ntf_status'}, //Pass $id
        dataType: 'json',
        cache: false,
        context: this,
        success: function (data) {
            $('.ntf_count').empty();
            $('.ntf_count').append(0);
        },
        complete: function (data) {

        },
        error: function (e) {
            // Error
        }
});
});

    $('.content_ntf').each(function () {
        var username = $(this).attr('data-username');

        $.ajax({
            type: 'post',
            url: '../../../views/user/contents/toolbar_notification/notifications.php', //Here you will fetch records
            data: {'username': username, 'ntf_type': 'ntf_seek_all'}, //Pass $id
            dataType: 'json',
            cache: false,
            context: this,
            success: function (data) {
                // console.log(data);
                len = data.length;
                if(len!=0) {
                    $('.content_ntf').empty();
                    for(i=0;i<len;i++) {
                        // console.log(data[i]['notification_url']);

                        local = data[i]['notification_utc_time'];
                        var localDate = new Date(local);
                        var today = new Date();
                        var old_date = localDate.getDate();
                        var new_date = today.getDate();
                        var old_month = localDate.getMonth();
                        var new_month = today.getMonth();
                        var old_year = localDate.getYear();
                        var new_year = today.getYear();
                        var days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
                        var day = days[localDate.getDay()];
                        if ((new_date - old_date) == 0) {
                            day = 'Today';

                            var localDateString = localDate.toLocaleDateString(undefined, {
                                month: 'short',
                                day: 'numeric'
                            });

                            var localTimeString = localDate.toLocaleTimeString(undefined, {
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                            var ntf_time = day + ' at ' + localTimeString;
                        }
                        if ((new_date - old_date) == 1) {
                            day = 'Yesterday';

                            var localDateString = localDate.toLocaleDateString(undefined, {
                                month: 'short',
                                day: 'numeric'
                            });

                            var localTimeString = localDate.toLocaleTimeString(undefined, {
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                            var ntf_time = day + ' at ' + localTimeString;
                        }
                        if (((new_date - old_date) > 1) || ((new_date - old_date) < 0)) {


                            var localDateString = localDate.toLocaleDateString(undefined, {
                                month: 'short',
                                day: 'numeric'
                            });


                            var localTimeString = localDate.toLocaleTimeString(undefined, {
                                hour: '2-digit',
                                minute: '2-digit'
                            });

                            var ntf_time = localDateString + ' at ' + localTimeString;
                        }

                        if (data[i]['notification_type'] == 'seen') {


                            var data_show = "<a href="+ data[i]['notification_url'] + " class="+'ntf_seen'+" data-ntf="+data[i]['notification_url']+"><div class="+'media-left'+"><i class="+'icon-eye4'+"></i></div><div class="+'media-body'+"><h6 class="+'media-heading'+"></h6>"+data[i]['notification_details']+' your post'+' on '+ntf_time+"</div></a>";

                            // var data_show = "<li class=" + 'media' + "><div class=" + 'media-left' + "><a href=" + data[i]['notification_url'] + " class="+'btn_ntf_seen'+"><i class="+'icon-eye4'+"></i></a></div><div class="+'media-body'+"><a href=" + data[i]['notification_url'] + " class="+'text-primary'+">"+data[i]['notification_details']+' on '+ntf_time+"</a></div></li>";
                            $(this).append(data_show);
                            $('.ntf_seen').addClass('media-link').addClass('btn').addClass('border-primary').addClass('text-primary').addClass('btn-flat').addClass('btn-icon').addClass('btn-sm').addClass('ntf-id-read');
                        }
                        if ((data[i]['notification_type'] == 'comment') && (data[i]['to_username'] == username)) {

                            var data_show = "<a href="+ data[i]['notification_url'] + " class="+'ntf_comment'+" data-ntf="+data[i]['notification_url']+"><div class="+'media-left'+"><i class="+'icon-bubble-lines4'+"></i></div><div class="+'media-body'+"><h6 class="+'media-heading'+"></h6>"+data[i]['notification_details']+' your post'+' on '+ntf_time+"</div></a>";
                            // var data_show = "<li class=" + 'media' + "><div class=" + 'media-left' + "><a href=" + data[i]['notification_url'] + " class="+'btn_ntf_comment'+"><i class="+'icon-bubble-lines4'+"></i></a></div><div class="+'media-body'+"><a href=" + data[i]['notification_url'] + " class="+'text-warning'+">"+data[i]['notification_details']+' your post'+' on '+ntf_time+"</a></div></li>";
                            $(this).append(data_show);
                            $('.ntf_comment').addClass('media-link').addClass('btn').addClass('border-warning').addClass('text-warning').addClass('btn-flat').addClass('btn-icon').addClass('btn-sm').addClass('ntf-id-read');
                        }
                        if ((data[i]['notification_type'] == 'connection') && (data[i]['to_username'] == username)) {

                            var data_show = "<a href="+ data[i]['notification_url'] + " class="+'ntf_connection'+" data-ntf="+data[i]['notification_url']+"><div class="+'media-left'+"><i class="+'icon-user-check'+"></i></div><div class="+'media-body'+"><h6 class="+'media-heading'+"></h6>"+data[i]['notification_details']+' your post'+' on '+ntf_time+"</div></a>";
                            // var data_show = "<li class=" + 'media' + "><div class=" + 'media-left' + "><a href=" + data[i]['notification_url'] + " class="+'btn_ntf_connection'+"><i class="+'icon-user-check'+"></i></a></div><div class="+'media-body'+"><a href=" + data[i]['notification_url'] + " class="+'text-success'+">"+data[i]['notification_details']+' on '+ntf_time+"</a></div></li>";
                            $(this).append(data_show);
                            $('.ntf_connection').addClass('media-link').addClass('btn').addClass('border-success').addClass('text-success').addClass('btn-flat').addClass('btn-icon').addClass('btn-sm').addClass('ntf-id-read');
                        }
                    }
                }else{
                    $('.content_ntf').empty();
                    $(this).empty();
                    $(this).append("<li class=" + 'media' + "><center>" + 'No Notifications' + "</center></li>");
                }

            },
            complete: function (data) {

                $('.ntf-id-read').click(function (r) {
                    var ntf_url = $(this).attr('data-ntf');
                    $.ajax({
                        type: 'post',
                        url: '../../../views/user/contents/toolbar_notification/notifications.php', //Here you will fetch records
                        data: {'ntf_url': ntf_url, 'ntf_type': 'ntf_read'}, //Pass $id
                        dataType: 'json',
                        cache: false,
                        context: this,
                        success: function (data) {
                            // console.log(data);
                        },
                        complete: function (data) {

                        },
                        error: function (e) {
                            // Error
                        }
                    });

                });

            },
            error: function (e) {
                // Error
            }

        });
    });

});